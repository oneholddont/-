<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音频播放器</title>
    <style>
        .audio-container {
            margin: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        button {
            display: inline-block;
            margin-top: 10px;
            background: none;
            border: none;
            cursor: pointer;
        }
        .progress-bar {
            width: 100%;
            background-color: #f3f3f3;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-top: 10px;
            height: 20px;
            position: relative;
        }
        .progress {
            background-color: #4caf50;
            height: 100%;
            width: 0%;
            border-radius: 5px;
        }
        .volume-control {
            margin-top: 10px;
        }
        .header-text {
            margin: 20px;
            text-align: center;
            font-size: 1.5em;
        }
        .play-icon {
            width: 24px;
            height: 24px;
        }
        .options {
            margin-top: 10px;
        }
        .submit-container {
            text-align: center;
            margin: 20px;
        }
    </style>
</head>
<body>

    <div class="header-text">
        <p>以下单词里有无促音？</p>
        <p>以下の単語には促音がありますか？</p>
    </div>

    <div class="audio-container">
        <h3>录音 1</h3>
        <audio id="audio1">
            <source src="audio1.mp3" type="audio/mpeg">
            您的浏览器不支持 audio 元素。
        </audio>
        <button onclick="playAudio('audio1')">
            <img src="https://img.icons8.com/ios-filled/50/000000/play.png" class="play-icon" alt="播放">
        </button>
        <div class="progress-bar">
            <div class="progress" id="progress1"></div>
        </div>
        <div class="volume-control">
            <label for="volume1">音量：</label>
            <input type="range" id="volume1" min="0" max="1" step="0.1" value="1" onchange="setVolume('audio1', this.value)">
        </div>
        <div class="options">
            <label>
                <input type="radio" name="option1" value="有" onchange="checkOptions()"> 有
            </label>
            <label>
                <input type="radio" name="option1" value="无" onchange="checkOptions()"> 无
            </label>
        </div>
    </div>

    <div class="audio-container">
        <h3>录音 2</h3>
        <audio id="audio2">
            <source src="audio2.mp3" type="audio/mpeg">
            您的浏览器不支持 audio 元素。
        </audio>
        <button onclick="playAudio('audio2')">
            <img src="https://img.icons8.com/ios-filled/50/000000/play.png" class="play-icon" alt="播放">
        </button>
        <div class="progress-bar">
            <div class="progress" id="progress2"></div>
        </div>
        <div class="volume-control">
            <label for="volume2">音量：</label>
            <input type="range" id="volume2" min="0" max="1" step="0.1" value="1" onchange="setVolume('audio2', this.value)">
        </div>
        <div class="options">
            <label>
                <input type="radio" name="option2" value="有" onchange="checkOptions()"> 有
            </label>
            <label>
                <input type="radio" name="option2" value="无" onchange="checkOptions()"> 无
            </label>
        </div>
    </div>

    <div class="audio-container">
        <h3>录音 3</h3>
        <audio id="audio3">
            <source src="audio3.mp3" type="audio/mpeg">
            您的浏览器不支持 audio 元素。
        </audio>
        <button onclick="playAudio('audio3')">
            <img src="https://img.icons8.com/ios-filled/50/000000/play.png" class="play-icon" alt="播放">
        </button>
        <div class="progress-bar">
            <div class="progress" id="progress3"></div>
        </div>
        <div class="volume-control">
            <label for="volume3">音量：</label>
            <input type="range" id="volume3" min="0" max="1" step="0.1" value="1" onchange="setVolume('audio3', this.value)">
        </div>
        <div class="options">
            <label>
                <input type="radio" name="option3" value="有" onchange="checkOptions()"> 有
            </label>
            <label>
                <input type="radio" name="option3" value="无" onchange="checkOptions()"> 无
            </label>
        </div>
    </div>

    <div class="submit-container">
        <label for="username">请输入您的名字：</label>
        <input type="text" id="username" name="username">
        <br><br>
        <button id="submit-button" onclick="submitData()" disabled>提交</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <script>
        function playAudio(audioId) {
            var audio = document.getElementById(audioId);
            audio.play();
        }

        function setVolume(audioId, volume) {
            var audio = document.getElementById(audioId);
            audio.volume = volume;
        }

        function updateProgress(audioId, progressId) {
            var audio = document.getElementById(audioId);
            var progress = document.getElementById(progressId);

            audio.addEventListener('timeupdate', function() {
                var percent = (audio.currentTime / audio.duration) * 100;
                progress.style.width = percent + '%';
            });
        }

        function checkOptions() {
            var option1 = document.querySelector('input[name="option1"]:checked');
            var option2 = document.querySelector('input[name="option2"]:checked');
            var option3 = document.querySelector('input[name="option3"]:checked');
            var username = document.getElementById('username').value.trim();

            var submitButton = document.getElementById('submit-button');
            if (option1 && option2 && option3 && username) {
                submitButton.disabled = false;
            } else {
                submitButton.disabled = true;
            }
        }

        document.getElementById('username').addEventListener('input', checkOptions);

        async function submitData() {
            var option1 = document.querySelector('input[name="option1"]:checked').value;
            var option2 = document.querySelector('input[name="option2"]:checked').value;
            var option3 = document.querySelector('input[name="option3"]:checked').value;
            var username = document.getElementById('username').value;

            // Load existing Excel file
            const response = await fetch('result.xlsx');
            const arrayBuffer = await response.arrayBuffer();
            const workbook = XLSX.read(arrayBuffer, { type: 'array' });
            const worksheet = workbook.Sheets[workbook.SheetNames[0]];

            // Find the next empty row
            const range = XLSX.utils.decode_range(worksheet['!ref']);
            const newRow = range.e.r + 1;

            // Insert new data
            XLSX.utils.sheet_add_aoa(worksheet, [[username, option1, option2, option3]], {origin: -1});

            // Update the worksheet reference range
            worksheet['!ref'] = XLSX.utils.encode_range(range.s, { r: newRow, c: range.e.c });

            // Save updated Excel file
            XLSX.writeFile(workbook, 'result.xlsx');
        }

        document.addEventListener('DOMContentLoaded', function() {
            updateProgress('audio1', 'progress1');
            updateProgress('audio2', 'progress2');
            updateProgress('audio3', 'progress3');
        });
    </script>

</body>
</html>
